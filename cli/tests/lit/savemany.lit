# SPDX-FileCopyrightText: Â© 2021 ChiselStrike <info@chiselstrike.com>

# RUN: sh -e @file

cd "$TEMPDIR"

cat << EOF > "$TEMPDIR/models/types.ts"
import { ChiselEntity } from "@chiselstrike/chiselstrike";

export class Person extends ChiselEntity {
    name: string;
    isQueen: boolean;
    constructor(name: string, isQueen: boolean) {
        super();
        this.name = name;
        this.isQueen = isQueen;
    }
}
EOF

cat << EOF > "$TEMPDIR/endpoints/savemany.ts"
export default async function chisel(req: Request) {
    const promises = [];

    promises.push(new Person('Elizabeth', true).save());
    promises.push(new Person('Victoria', true).save());
    promises.push(new Person('FreddieMercury', true).save());
    promises.push(new Person('William', false).save());

    await Promise.all(promises);
    return new Response('Ok');
}
EOF

$CHISEL apply
# CHECK: Type defined: Person
# CHECK: End point defined: /dev/savemany

$CURL -X POST $CHISELD_HOST/dev/savemany
# CHECK: Ok
