# SPDX-FileCopyrightText: Â© 2021 ChiselStrike <info@chiselstrike.com>

# RUN: sh -e @file

cd "$TEMPDIR"

cat << EOF > "$TEMPDIR/types/types.ts"
export class Person extends ChiselEntity { name: string; isQueen: boolean;}
EOF

cat << EOF > "$TEMPDIR/endpoints/savemany.ts"
export default async function chisel(req: Request) {
    let promises = [];
    for (const c of [
        {name: 'Elizabeth', isQueen: true},
        {name: 'Victoria', isQueen: true},
        {name: 'FreddieMercury', isQueen: true},
        {name: 'William', isQueen: false}
    ]) {
        promises.push(Chisel.save('Person', c));
    }
    await Promise.all(promises);
    return new Response('Ok');
}
EOF

$CHISEL apply
# CHECK: Type defined: Person
# CHECK: End point defined: /dev/savemany

$CURL -X POST $CHISELD_HOST/dev/savemany
# CHECK: Ok
