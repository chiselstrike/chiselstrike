# SPDX-FileCopyrightText: Â© 2021 ChiselStrike <info@chiselstrike.com>

# RUN: sh -e @file

cp examples/person.ts "$TEMPDIR/types"

cat << EOF > "$TEMPDIR/endpoints/query.ts"
export default async function chisel(req: Request) {
    const filtered = Person.findMany({"foo": "bar"});
    let ret = "";
    for await (let row of filtered) {
        ret += row.first_name + " " + row.last_name + "\n";
    }
    return new Response(ret);
}
EOF

cd "$TEMPDIR"
$CHISEL apply 2>&1 || true

# CHECK: query.ts (2,39): Argument of type '{ foo: string; }' is not assignable to parameter of type 'Partial<Person>'.
