# SPDX-FileCopyrightText: Â© 2022 ChiselStrike <info@chiselstrike.com>

# RUN: sh -e @file

cat << EOF > "$TEMPDIR/endpoints/goldilocks.ts"
// FIXME, Using esm.sh is a hack, but I could not build a usable .d.ts
import { MinLength, MaxLength, is } from 'https://esm.sh/@deepkit/type@1.0.1-alpha.72?target=deno'

export default function chisel(req: Request) {
        type Goldilocks = string & MinLength<5> & MaxLength<10>;
        const ret = [is<Goldilocks>('1234'),
                     is<Goldilocks>('12345'),
                     is<Goldilocks>('123456789A'),
                     is<Goldilocks>('123456789AB')];
        return new Response(JSON.stringify(ret));
}
EOF

cd "$TEMPDIR"
$CHISEL apply

$CURL -o - $CHISELD_HOST/dev/goldilocks
# CHECK: [false,true,true,false]
