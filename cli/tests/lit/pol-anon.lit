# SPDX-FileCopyrightText: Â© 2021 ChiselStrike <info@chiselstrike.com>

# RUN: CURL="@curl" sh -e @file

$CHISEL type import examples/person.graphql

# CHECK: Type defined: Person

$CHISEL end-point create ins examples/store.js

# CHECK: End point defined: /ins

$CURL --data '{
    "first_name":"hello", 
    "last_name":"world", 
    "age": 2147483647, 
    "human": false, 
    "height": 12742333
}' -o - $CHISELD_HOST/ins

# CHECK: ok

$CHISEL end-point create find examples/find.js

# CHECK: End point defined: /find

$CURL -o - $CHISELD_HOST/find

# CHECK: HTTP/1.1 200 OK
# CHECK: hello world 2147483647 false 12742333

cat << EOF | $CHISEL policy update -
labels:
  - name: pii
    transform: anonymize
EOF

$CURL -o - $CHISELD_HOST/find

# CHECK: HTTP/1.1 200 OK
# CHECK: hello xxxxx
