# SPDX-FileCopyrightText: Â© 2021 ChiselStrike <info@chiselstrike.com>

# RUN: sh -e @file

$CURL $CHISELD_HOST/__chiselstrike/auth/callback?user=alice
$CURL $CHISELD_HOST/__chiselstrike/auth/callback?user=bob
$CURL $CHISELD_HOST/__chiselstrike/auth/callback?user=charlie

cat << EOF > "$TEMPDIR/endpoints/users.ts"
export default async function chisel(req: Request) {
    let response = "";
    for await (let u of OAuthUser) {
        response += u.username + " ";
    }
    return new Response(response);
}
EOF

cd "$TEMPDIR"
$CHISEL apply
$CURL $CHISELD_HOST/dev/users
# CHECK: alice bob charlie
