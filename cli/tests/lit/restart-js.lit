# SPDX-FileCopyrightText: Â© 2021 ChiselStrike <info@chiselstrike.com>

# RUN: CHISEL="@chisel" CURL="@curl" sh -e @file

cat << EOF | $CHISEL end-point create test1 -
function foo() {
    return "test OK"
}

async function chisel(req) {
    return new Response(foo());
}
EOF

# CHECK: End point defined: /test1

$CURL -o - localhost:3000/test1
# CHECK: HTTP/1.1 200 OK
# CHECK: test OK

echo

$CHISEL restart

# CHECK: success
sleep 1

cat << EOF | $CHISEL end-point create test2 -
async function chisel(req) {
    return new Response(foo());
}
EOF

# CHECK: End point defined: /test2

$CURL -o - localhost:3000/test2

# CHECK: HTTP/1.1 500 Internal Server Error
# CHECK: foo is not defined
