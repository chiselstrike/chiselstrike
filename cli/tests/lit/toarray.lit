# SPDX-FileCopyrightText: Â© 2021 ChiselStrike <info@chiselstrike.com>

# RUN: sh -e @file

cd "$TEMPDIR"

cat << EOF > "$TEMPDIR/types/types.ts"
class Person extends ChiselEntity { name: string; country: string; }
EOF

cat << EOF > "$TEMPDIR/endpoints/store.ts"
export default async function chisel(req: Request) {
    await Chisel.save("Person", {"name": "Glauber", "country": "Canada"});
    await Chisel.save("Person", {"name": "Pekka", "country": "Finland"});
    return new Response("Ok");
}
EOF

cat << EOF > "$TEMPDIR/endpoints/toarray.ts"
export default async function chisel(req: Request) {
    let people = await Person.select("name").toArray()
    return new Response(JSON.stringify(people));
}
EOF

$CHISEL apply
# CHECK: Type defined: Person
# CHECK: End point defined: /dev/store
# CHECK: End point defined: /dev/toarray

$CURL $CHISELD_HOST/dev/store
# CHECK: Ok

$CURL $CHISELD_HOST/dev/toarray
# CHECK: [{"name":"Glauber"},{"name":"Pekka"}]
